@model List<Pronia.Models.Product>

<style>
    /* Фиксируем таблицу, чтобы она не растягивалась */
    .table {
        table-layout: fixed;
        width: 100%;
    }

    /* Настройка колонок с текстом */
    .truncate-text {
        white-space: nowrap;      /* Текст в одну строку */
        overflow: hidden;         /* Скрываем лишнее */
        text-overflow: ellipsis;  /* Добавляем три точки (...) */
    }

    /* Колонку с кнопками делаем минимально необходимой ширины */
    .actions-column {
        width: 160px;
        white-space: nowrap;
    }
</style>

<div class="container mt-4">
    <h2>Products</h2>
    <a asp-action="Create" class="btn btn-success mb-3">Create New Product</a>

    <table class="table table-bordered table-striped">
        <thead>
        <tr>
            <th style="width: 50px;">Id</th>
            <th style="width: 150px;">Name</th>
            <th>Description</th>
            <th style="width: 80px;">Price</th>
            <th style="width: 90px;">Image</th>
            <th style="width: 120px;">Category</th>
            <th class="actions-column">Actions</th>
        </tr>
        </thead>
        <tbody>
        @foreach(var product in Model)
        {
        <tr>
            <td>@product.Id</td>
            @* Ограничиваем имя *@
            <td class="truncate-text" title="@product.Name">@product.Name</td>
            @* Ограничиваем описание *@
            <td class="truncate-text" title="@product.Description">@product.Description</td>
            <td>@product.Price ₼</td>
            <td>
                @* Исправленный путь: добавляем /assets/... и проверку *@
                <img src="/assets/images/website-images/@product.ImagePath"
                     style="width:70px; height:70px; object-fit: cover; border-radius: 5px;"
                     onerror="this.onerror=null;this.src='/assets/images/no-image.png';" />
            </td>
            <td>@product.Category?.Name</td>
            <td class="actions-column">
                <a asp-action="Update" asp-route-id="@product.Id" class="btn btn-warning btn-sm">Edit</a>
                <button onclick="deleteProduct(@product.Id)" class="btn btn-danger btn-sm">Delete</button>
            </td>
        </tr>
        }
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function deleteProduct(id) {
        Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                // Используем метод POST или DELETE, если контроллер настроен так
                fetch(`/Admin/Product/Delete/${id}`, { method: 'POST' })
                    .then(res => {
                        if (res.ok) {
                            location.reload();
                        } else {
                            Swal.fire("Error!", "Could not delete product.", "error");
                        }
                    });
            }
        });
    }
</script>